<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Country</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<style>
    body {
        font-family: Arial, sans-serif;
    }
    nav {
        background-color: #333;
        overflow: hidden;
    }
    nav a {
        float: left;
        display: block;
        color: white;
        text-align: center;
        padding: 14px 16px;
        text-decoration: none;
    }
    nav a:hover {
        background-color: #ddd;
        color: black;
    }
</style>
</head>
<body>
<nav>
    <a href="/create">Create</a>
    <a href="/read">Read</a>
    <a href="/update">Update</a>
    <a href="/delete">Delete</a>
</nav>
<body>
    <h1>Update Country</h1>

    <!-- Form for selecting the Name Common from a dropdown list -->
    <form id="name-common-form">
        <label for="name_common">Name Common:</label>
        <select id="name_common" required></select>
        <button type="button" id="get-data-button">Get Data</button>
    </form>

    <!-- Display existing data for the selected country -->
    <div id="existing-data"></div>

    <!-- Form for updating an existing country -->
    <form id="update-form" method="POST" style="display: none;">
        <!-- Add input fields for updating data -->
        <label for="region">Region:</label>
        <input type="text" name="region" required><br>

        <label for="subregion">Subregion:</label>
        <input type="text" name="subregion" required><br>

        <label for="population">Population:</label>
        <input type="text" name="population" required><br>

        <label for="currencies_name">Currencies Name:</label>
        <input type="text" name="currencies_name" required><br>

        <label for="languages">Languages:</label>
        <input type="text" name="languages" required><br>

        <label for="unMember">UN Member:</label>
        <input type="text" name="unMember" required><br>

        <label for="capital">Capital:</label>
        <input type="text" name="capital" required><br>

        <label for="car_signs">Car Signs:</label>
        <input type="text" name="car_signs" required><br>

        <label for="car_side">Car Side:</label>
        <input type="text" name="car_side" required><br>

        <button type="submit">Update</button>
    </form>

    <script>
        $(document).ready(function() {
            // Populate the dropdown list with country names
            $.ajax({
                url: '/get_all_countries',
                type: 'GET',
                success: function(data) {
                    // Populate the dropdown list with country names
                    var dropdownOptions = '<option value="">Select a country</option>';
                    data.forEach(function(country) {
                        dropdownOptions += '<option value="' + country.name_common + '">' + country.name_common + '</option>';
                    });
                    $('#name_common').html(dropdownOptions);
                },
                error: function(error) {
                    console.error('Error fetching country names:', error);
                }
            });

            // Fetch existing data for the selected country
            $('#get-data-button').click(function() {
                var nameCommon = $('#name_common').val();

                $.ajax({
                    url: '/get_country_by_name',
                    type: 'GET',
                    data: { name: nameCommon },
                    success: function(data) {
                        // Display existing data for the country
                        var existingDataHtml = '<h2>Existing Data:</h2>';
                        existingDataHtml += '<ul>';
                        existingDataHtml += '<li>Name Common: ' + data.name_common + '</li>';
                        existingDataHtml += '<li>Region: ' + data.region + '</li>';
                        existingDataHtml += '<li>Subregion: ' + data.subregion + '</li>';
                        existingDataHtml += '<li>Population: ' + data.population + '</li>';
                        existingDataHtml += '<li>Currencies Name: ' + data.currencies_name + '</li>';
                        existingDataHtml += '<li>Languages: ' + data.languages + '</li>';
                        existingDataHtml += '<li>UN Member: ' + data.unMember + '</li>';
                        existingDataHtml += '<li>Capital: ' + data.capital + '</li>';
                        existingDataHtml += '<li>Car Signs: ' + data.car_signs + '</li>';
                        existingDataHtml += '<li>Car Side: ' + data.car_side + '</li>';
                        existingDataHtml += '</ul>';

                        // Show the update form
                        $('#existing-data').html(existingDataHtml);
                        $('#update-form').show();
                    },
                    error: function(error) {
                        console.error('Error fetching existing data:', error);
                        $('#existing-data').html('<p>No data found for the selected Name Common.</p>');
                        $('#update-form').hide();
                    }
                });
            });

            // Submit the update form using AJAX
            $('#update-form').submit(function(event) {
                event.preventDefault();

                $.ajax({
                    url: '/update',
                    type: 'POST',
                    data: $(this).serialize(),
                    success: function(response) {
                        if (response.status === 'success') {
                            // Display a success message or redirect to another page
                        } else {
                            console.error('Error updating country:', response.error);
                        }
                    },
                    error: function(error) {
                        console.error('Error updating country:', error);
                    }
                });
            });
        });
    </script>
</body>
</html>
